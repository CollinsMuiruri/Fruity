<!-- sales/templates/sales/create_order.html -->
{% extends 'sales/base.html' %}

{% block content %}
  <h1>Create Order</h1>
  <form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Create Order</button>
  </form>

  <hr>

  <h2>Create New Product</h2>
  <button type="button" onclick="openCreateProductModal()">Add Product</button>

  <!-- Create Product Modal -->
  <div id="createProductModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeCreateProductModal()">&times;</span>
      <h3>New Product</h3>
      <form id="createProductForm">
        {% csrf_token %}
        <label for="id_name">Name:</label>
        <input type="text" id="id_name" name="name">

        <label for="id_price">Price:</label>
        <input type="text" id="id_price" name="price">

        <!-- Add more fields for product creation as needed -->

        <button type="submit">Create</button>
      </form>
    </div>
  </div>

  <script>
    // Open the Create Product modal
    function openCreateProductModal() {
      var modal = document.getElementById("createProductModal");
      modal.style.display = "block";
    }

    // Close the Create Product modal
    function closeCreateProductModal() {
      var modal = document.getElementById("createProductModal");
      modal.style.display = "none";
    }

    // Submit the Create Product form via AJAX
    var createProductForm = document.getElementById("createProductForm");
    createProductForm.addEventListener("submit", function (event) {
      event.preventDefault();
      var form = event.target;
      var formData = new FormData(form);
      
      fetch("{% url 'create_product' %}", {
        method: "POST",
        body: formData,
        headers: {
          "X-CSRFToken": "{{ csrf_token }}",
        },
      })
        .then(function (response) {
          if (response.ok) {
            // Reload the page to update the product dropdown
            location.reload();
          } else {
            // Handle the error case if needed
            console.error("Failed to create the product");
          }
        })
        .catch(function (error) {
          // Handle the error case if needed
          console.error("Failed to create the product", error);
        });
    });
  </script>
{% endblock %}
